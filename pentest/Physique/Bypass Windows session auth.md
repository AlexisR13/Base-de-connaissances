```toc

```

# Objectif
L'objectif est d'accéder à la session d'un utilisateur Windows en réinitialisant/modifiant son mot de passe. 
Pour cela, on va booter sur une clé USB, modifier les fichiers executables pour rendre *cmd.exe* accessible sans connexion à une session, puis redémarrer normalement et utiliser un terminal pour modifier le mot de passe.
*Pré-requis* : Cette technique fonctionne uniquement si le disque n'est pas chiffré.

# Etapes

## Préparation
Créer une clé USB d'installation Windows.  
https://support.microsoft.com/en-us/windows/create-installation-media-for-windows-99a58364-8c02-206f-aa6f-40c3b507420d

## Boot sur la clé
On boot sur la clé USB puis on s'assure de trouver le disque sur lequel Windows est installé avant de déplacer cmd.exe à la place d'un utilitaire Windows :
1. *SHIFT+F10* pour ouvrir un terminal
2. Commande `DISKPART` puis `list volumes` pour afficher les disques
3. `D:` pour se déplacer sur le disque D (si c'est celui qui abrite Windows)
4. `cd Windows/System32`
5. `ren Utilman.exe Utilman.exe.old` pour garder une copie de l'utilitaire Windows
6. `copy cmd.exe Utilman.exe`

*Note* : si aucun disque n'apparait au début, il manque surement un driver et il faut quitter le terminal et faire le début de la procédure d'installation Windows pour récupérer le driver manquant avant de reprendre.

## Accès à la session
On redémarre l'ordinateur puis sur l'écran de connexion à la session, on clique sur le bouton en bas à droite qui ressemble vaguement à une horloge. Ce bouton est mappé sur l'exécutable *Utilman.exe* et ouvre donc un terminal (avec suffisamment de droit pour modifier le mot de passe de l'utilisateur !).

Dans le terminal :
- `net user` : liste les utilisateurs
- `net user <username> *` : modifie le mot de passe de l'utilisateur "username"

Pour être plus discret, on peut aussi ajouter un utilisateur :
- `net user <username> /add`
- `net localgroup Administrators <username> /add` : rend cet utilisateur administrateur


