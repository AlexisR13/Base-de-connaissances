```toc

```
cf le cours sur l'AD : [[Cours/]]

# 1. Trouver le DC
La première étape consiste à trouver le contrôleur de domaine. Pour ça on peut :
- Utiliser *nslookup* car le DC sert souvent de DNS
- Utiliser *nmap* et regarder les services exposés

# 2. Enumération anonyme
```bash
# Enum all domain users, groups, ...
enum4linux -a -u "%" <DC_IP>

crackmapexec ldap
```


# 3. Enumération non-anonyme
```bash
enum4linux -a -u "user" -p "password" <DC_IP>
```


# 4. Accès à une machine
Dump des hash de mots de passe locaux.
Puis attaque Pass The Hash : `crackmapexec -h`





# Autres
## Lister les entrées DNS
L'AD répertorie des entrées DNS et par défaut tous les utilisateurs peuvent les lister. Certaines entrées sont cachées, i.e. on accède seulement au nom DNS et pas à l'IP et au type d'entrée (A, AAAA, ...) mais on peut récupère l'IP en faisant une requète DNS (c'est l'option -r).
https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/ad-dns-records
```bash
# Display DNS zones
adidnsdump -u <domain>\\<user> ldap://<DC_IP> --print-zones

# Enum DNS records
adidnsdump -u <domain>\\<user> ldap://<DC_IP> -r
cat records.csv

# Enum DNS records from a zone
adidnsdump -u <domain>\\<user> ldap://<DC_IP>.<DNS_zone> -r
cat records.csv
```
